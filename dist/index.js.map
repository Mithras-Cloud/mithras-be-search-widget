{"version":3,"sources":["../src/core/format.ts","../src/core/state.ts","../src/Widget.tsx"],"names":["emit"],"mappings":"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","file":"index.js","sourcesContent":["import { GroupSpec } from './types';\n\nexport const DEFAULT_GROUP: GroupSpec = {\n  rooms: 1,\n  adults: 2,\n  childrenAges: [],\n  infants: 0,\n};\n\nconst GROUP_SEPARATOR = ';';\nconst CHILD_SEPARATOR = '.';\n\nconst safeInt = (value: string, fallback = 0) => {\n  const parsed = Number.parseInt(value, 10);\n  return Number.isFinite(parsed) && parsed >= 0 ? parsed : fallback;\n};\n\nconst safeFloat = (value: string) => {\n  const parsed = Number.parseFloat(value);\n  return Number.isFinite(parsed) && parsed >= 0 ? parsed : 0;\n};\n\nexport const parseGroupsForm = (input?: string): GroupSpec[] => {\n  if (!input) return [DEFAULT_GROUP];\n\n  return input\n    .split(GROUP_SEPARATOR)\n    .map((segment) => segment.trim())\n    .filter(Boolean)\n    .map((segment) => {\n      const [roomsRaw, rest] = segment.split(':');\n      const [adultsRaw, childrenRaw = '0', infantsRaw = '0'] = (rest ?? '').split(',');\n      const childrenAges = childrenRaw\n        .split(CHILD_SEPARATOR)\n        .map((age) => age.trim())\n        .filter(Boolean)\n        .map((age) => safeFloat(age))\n        .filter((age) => age >= 0);\n\n      return {\n        rooms: Math.max(1, safeInt(roomsRaw, 1)),\n        adults: Math.max(1, safeInt(adultsRaw, 1)),\n        childrenAges,\n        infants: Math.max(0, safeInt(infantsRaw, 0)),\n      } satisfies GroupSpec;\n    });\n};\n\nexport const formatGroupsForm = (groups: GroupSpec[]): string =>\n  groups\n    .map((group) => {\n      const children = group.childrenAges.length\n        ? group.childrenAges.map((age) => age.toString()).join(CHILD_SEPARATOR)\n        : '0';\n      return `${group.rooms}:${group.adults},${children},${group.infants}`;\n    })\n    .join(GROUP_SEPARATOR);\n\nexport const summarizeGuests = (groups: GroupSpec[]) => {\n  const summary = groups.reduce(\n    (acc, group) => {\n      acc.rooms += group.rooms;\n      acc.adults += group.adults;\n      acc.children += group.childrenAges.length;\n      acc.infants += group.infants;\n      return acc;\n    },\n    { rooms: 0, adults: 0, children: 0, infants: 0 }\n  );\n  return summary;\n};\n\nexport const cloneGroups = (groups: GroupSpec[]): GroupSpec[] =>\n  groups.map((group) => ({ ...group, childrenAges: [...group.childrenAges] }));\n","import {\n  WidgetConfig,\n  WidgetState,\n  ValidationResult,\n  SearchRequest,\n  GroupSpec,\n  WidgetEvent,\n  WidgetEventType,\n} from './types';\nimport { cloneGroups, DEFAULT_GROUP, formatGroupsForm, parseGroupsForm } from './format';\n\nconst ISO_DATE_PATTERN = /\\d{4}-\\d{2}-\\d{2}/;\n\nconst todayIso = () => {\n  const now = new Date();\n  now.setHours(0, 0, 0, 0);\n  return now.toISOString().slice(0, 10);\n};\n\nconst addDays = (iso: string, days: number) => {\n  const date = new Date(iso);\n  date.setDate(date.getDate() + days);\n  return date.toISOString().slice(0, 10);\n};\n\nconst ensureIsoDate = (value: string | undefined, fallback: string) =>\n  value && ISO_DATE_PATTERN.test(value) ? value : fallback;\n\nconst DEFAULT_LOCALE = 'en';\nconst DEFAULT_CURRENCY = 'USD';\nconst DEFAULT_POS = 'GLOBAL';\nconst DEFAULT_PRODUCT_ID = 1000;\n\nexport const createInitialState = (config: WidgetConfig): WidgetState => {\n  const baseStart = ensureIsoDate(config.initialStart, todayIso());\n  const baseEnd = ensureIsoDate(config.initialEnd, addDays(baseStart, 1));\n\n  const startDate = baseStart;\n  let endDate = baseEnd;\n  if (endDate <= startDate) {\n    endDate = addDays(startDate, 1);\n  }\n\n  const parsedGroups = parseGroupsForm(config.initialGroups);\n  const groups = parsedGroups.length ? parsedGroups : [DEFAULT_GROUP];\n\n  return {\n    startDate,\n    endDate,\n    pos: config.pos ?? DEFAULT_POS,\n    locale: config.locale ?? DEFAULT_LOCALE,\n    currency: config.currency ?? DEFAULT_CURRENCY,\n    productId: config.productId ?? DEFAULT_PRODUCT_ID,\n    groups: cloneGroups(groups),\n    redirect: Boolean(config.redirect),\n    isSearching: false,\n    errors: {},\n  };\n};\n\nconst validateDateRange = (start: string, end: string) => {\n  if (!ISO_DATE_PATTERN.test(start)) return 'Start date is invalid.';\n  if (!ISO_DATE_PATTERN.test(end)) return 'End date is invalid.';\n  if (end <= start) return 'End date must be after start date.';\n  return null;\n};\n\nconst validateGroups = (groups: GroupSpec[]) => {\n  if (!groups.length) return 'At least one room group is required.';\n  for (const [index, group] of groups.entries()) {\n    if (group.rooms <= 0) return `Room ${index + 1}: rooms must be greater than 0.`;\n    if (group.adults <= 0) return `Room ${index + 1}: adults must be greater than 0.`;\n    if (group.childrenAges.some((age) => age < 0)) {\n      return `Room ${index + 1}: child ages must be >= 0.`;\n    }\n    if (group.infants < 0) return `Room ${index + 1}: infants must be >= 0.`;\n  }\n  return null;\n};\n\nexport const validateState = (state: WidgetState): ValidationResult => {\n  const errors: ValidationResult['errors'] = {};\n\n  const dateError = validateDateRange(state.startDate, state.endDate);\n  if (dateError) errors.dates = dateError;\n\n  if (!state.productId || state.productId <= 0) {\n    errors.productId = 'Product is required.';\n  }\n\n  const groupError = validateGroups(state.groups);\n  if (groupError) errors.groups = groupError;\n\n  if (!state.pos) errors.pos = 'POS is required.';\n  if (!state.locale) errors.locale = 'Language is required.';\n  if (!state.currency) errors.currency = 'Currency is required.';\n\n  return {\n    valid: Object.keys(errors).length === 0,\n    errors,\n  };\n};\n\nexport const buildSearchPayload = (\n  state: WidgetState,\n  config: WidgetConfig\n): SearchRequest => {\n  const groups_form = formatGroupsForm(state.groups);\n  return {\n    start_date: state.startDate,\n    end_date: state.endDate,\n    product_id: state.productId,\n    groups_form,\n    pos: state.pos,\n    language: state.locale,\n    currency: state.currency,\n    redirect: state.redirect ?? config.redirect ?? false,\n  };\n};\n\nexport const emit = (emitter: WidgetConfig['onEvent'] | undefined, event: WidgetEvent) => {\n  if (emitter) emitter(event);\n};\n\nexport const forwardEvent = (\n  emitter: WidgetConfig['onEvent'] | undefined,\n  type: WidgetEventType,\n  payload?: unknown\n) => emit(emitter, { type, payload });\n","import React, { FormEvent, useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { WidgetConfig, WidgetState, GroupSpec, WidgetEventType, SearchResponse } from './core/types';\nimport { cloneGroups, formatGroupsForm, summarizeGuests } from './core/format';\nimport { buildSearchPayload, createInitialState, forwardEvent, validateState } from './core/state';\n\nexport type BookingSearchWidgetProps = WidgetConfig & {\n  redirect?: boolean;\n};\n\nconst POS_OPTIONS = ['GLOBAL', 'HotelEscuela', 'HotelDelSol'];\nconst LOCALE_OPTIONS = [\n  { value: 'en', label: 'English' },\n  { value: 'es', label: 'Español' },\n  { value: 'pt', label: 'Português' },\n];\nconst CURRENCY_OPTIONS = ['USD', 'EUR', 'ARS', 'BRL'];\nconst THEME_CLASS = 'yw-container';\n\nconst styles = `\n.${THEME_CLASS} {\n  font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n  background: var(--yw-bg, #ffffff);\n  color: var(--yw-fg, #101828);\n  border: 1px solid rgba(16, 24, 40, 0.1);\n  border-radius: 12px;\n  padding: 1rem;\n  min-width: 280px;\n  max-width: 420px;\n  box-shadow: 0 8px 24px rgba(16, 24, 40, 0.08);\n}\n.${THEME_CLASS}[data-theme='dark'] {\n  background: var(--yw-bg, #101828);\n  color: var(--yw-fg, #ffffff);\n  border-color: rgba(255, 255, 255, 0.2);\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.75);\n}\n.${THEME_CLASS} h2 {\n  font-size: 1.1rem;\n  margin: 0 0 0.75rem;\n}\n.${THEME_CLASS} form {\n  display: grid;\n  gap: 0.75rem;\n}\n.${THEME_CLASS} label {\n  display: flex;\n  flex-direction: column;\n  font-size: 0.85rem;\n  gap: 0.35rem;\n}\n.${THEME_CLASS} input,\n.${THEME_CLASS} select,\n.${THEME_CLASS} button {\n  font: inherit;\n}\n.${THEME_CLASS} input,\n.${THEME_CLASS} select {\n  border-radius: 8px;\n  border: 1px solid rgba(16, 24, 40, 0.18);\n  padding: 0.5rem 0.6rem;\n  background: var(--yw-bg, #ffffff);\n  color: inherit;\n}\n.${THEME_CLASS}[data-theme='dark'] input,\n.${THEME_CLASS}[data-theme='dark'] select {\n  border-color: rgba(255, 255, 255, 0.18);\n}\n.${THEME_CLASS} .yw-row {\n  display: grid;\n  gap: 0.75rem;\n}\n.${THEME_CLASS} .yw-row--inline {\n  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n}\n.${THEME_CLASS} .yw-groups {\n  display: grid;\n  gap: 0.75rem;\n  border: 1px dashed rgba(16, 24, 40, 0.15);\n  padding: 0.75rem;\n  border-radius: 8px;\n}\n.${THEME_CLASS} .yw-group {\n  display: grid;\n  gap: 0.5rem;\n}\n.${THEME_CLASS} .yw-group-controls {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.${THEME_CLASS} .yw-group-controls label {\n  flex: 1;\n  min-width: 120px;\n}\n.${THEME_CLASS} .yw-actions {\n  display: flex;\n  justify-content: space-between;\n  gap: 0.75rem;\n  align-items: center;\n}\n.${THEME_CLASS} .yw-primary {\n  background: var(--yw-accent, #2563eb);\n  border: none;\n  color: #ffffff;\n  border-radius: 999px;\n  padding: 0.65rem 1.25rem;\n  cursor: pointer;\n  transition: transform 0.15s ease, box-shadow 0.2s ease;\n}\n.${THEME_CLASS} .yw-primary:disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n}\n.${THEME_CLASS} .yw-secondary {\n  background: transparent;\n  border: 1px solid rgba(16, 24, 40, 0.2);\n  color: inherit;\n  border-radius: 999px;\n  padding: 0.55rem 1rem;\n  cursor: pointer;\n}\n.${THEME_CLASS} .yw-error {\n  color: #dc2626;\n  font-size: 0.8rem;\n}\n.${THEME_CLASS}[data-theme='dark'] .yw-error {\n  color: #f87171;\n}\n.${THEME_CLASS} .yw-summary {\n  font-size: 0.85rem;\n  opacity: 0.8;\n}\n`;\n\nconst ensureStyles = () => {\n  if (typeof document === 'undefined') return;\n  if (document.getElementById('yw-styles')) return;\n  const tag = document.createElement('style');\n  tag.id = 'yw-styles';\n  tag.textContent = styles;\n  document.head.appendChild(tag);\n};\n\nconst mergeGroups = (groups: GroupSpec[], index: number, patch: Partial<GroupSpec>): GroupSpec[] => {\n  const next = cloneGroups(groups);\n  next[index] = {\n    ...next[index],\n    ...patch,\n    childrenAges: patch.childrenAges ?? next[index].childrenAges,\n  };\n  return next;\n};\n\nconst parseChildrenInput = (value: string): number[] =>\n  value\n    .split(/[.,]/)\n    .map((age) => age.trim())\n    .filter(Boolean)\n    .map(Number)\n    .filter((age) => Number.isFinite(age) && age >= 0);\n\nexport const BookingSearchWidget: React.FC<BookingSearchWidgetProps> = (props) => {\n  const [state, setState] = useState<WidgetState>(() => createInitialState(props));\n  const hasHydrated = useRef(false);\n\n  useEffect(() => {\n    ensureStyles();\n  }, []);\n\n  useEffect(() => {\n    if (!hasHydrated.current) {\n      hasHydrated.current = true;\n      return;\n    }\n    setState(createInitialState(props));\n  }, [\n    props.initialStart,\n    props.initialEnd,\n    props.initialGroups,\n    props.locale,\n    props.currency,\n    props.pos,\n    props.productId,\n    props.redirect,\n  ]);\n\n  const emit = useCallback(\n    (type: WidgetEventType, payload?: unknown) => {\n      forwardEvent(props.onEvent, type, payload);\n    },\n    [props.onEvent]\n  );\n\n  useEffect(() => {\n    emit('ready', { state });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleStateChange = useCallback(\n    (next: Partial<WidgetState> | ((prev: WidgetState) => WidgetState)) => {\n      setState((prev) => {\n        const candidate = typeof next === 'function' ? (next as (prev: WidgetState) => WidgetState)(prev) : { ...prev, ...next };\n        emit('change', { state: candidate });\n        return candidate;\n      });\n    },\n    [emit]\n  );\n\n  const handleSubmit = async (event: FormEvent) => {\n    event.preventDefault();\n    const validation = validateState(state);\n    if (!validation.valid) {\n      handleStateChange({ errors: validation.errors });\n      emit('validate_error', validation);\n      return;\n    }\n\n    const payload = buildSearchPayload({ ...state, errors: {} }, props);\n    handleStateChange({ isSearching: true, errors: {} });\n    emit('search_start', payload);\n\n    try {\n      const response = await fetch('https://gateway-prod.pxsol.com/v2/search', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${props.token}`,\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Search failed with status ${response.status}`);\n      }\n\n      const data = (await response.json()) as SearchResponse;\n      handleStateChange({ isSearching: false, lastResponse: data });\n      emit('search_success', { request: payload, response: data });\n\n      if ((payload.redirect || props.redirect) && data.booking_engine_url) {\n        window.location.assign(data.booking_engine_url);\n      }\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error('Unexpected error');\n      handleStateChange({ isSearching: false });\n      emit('search_error', { request: payload, error: err });\n      console.error('[booking-search-widget]', err);\n    }\n  };\n\n  const groupsSummary = useMemo(() => summarizeGuests(state.groups), [state.groups]);\n\n  const errorMessage = Object.values(state.errors)[0];\n\n  const addGroup = () => {\n    handleStateChange((prev) => ({\n      ...prev,\n      groups: [...cloneGroups(prev.groups), { rooms: 1, adults: 2, childrenAges: [], infants: 0 }],\n    }));\n  };\n\n  const removeGroup = (index: number) => {\n    handleStateChange((prev) => ({\n      ...prev,\n      groups: prev.groups.filter((_, idx) => idx !== index),\n    }));\n  };\n\n  const onGroupChange = (index: number, patch: Partial<GroupSpec>) => {\n    handleStateChange((prev) => ({\n      ...prev,\n      groups: mergeGroups(prev.groups, index, patch),\n    }));\n  };\n\n  const onChildrenChange = (index: number, value: string) => {\n    const childrenAges = parseChildrenInput(value);\n    onGroupChange(index, { childrenAges });\n  };\n\n  return (\n    <div className={THEME_CLASS} data-theme={props.theme ?? 'light'} role=\"region\" aria-live=\"polite\">\n      <h2>Booking search</h2>\n      <form onSubmit={handleSubmit} noValidate>\n        <div className=\"yw-row yw-row--inline\">\n          <label>\n            <span>Check-in</span>\n            <input\n              type=\"date\"\n              value={state.startDate}\n              onChange={(event) => handleStateChange({ startDate: event.target.value })}\n              required\n            />\n          </label>\n          <label>\n            <span>Check-out</span>\n            <input\n              type=\"date\"\n              value={state.endDate}\n              min={state.startDate}\n              onChange={(event) => handleStateChange({ endDate: event.target.value })}\n              required\n            />\n          </label>\n        </div>\n\n        <div className=\"yw-row yw-row--inline\">\n          <label>\n            <span>POS</span>\n            <select value={state.pos} onChange={(event) => handleStateChange({ pos: event.target.value })}>\n              {POS_OPTIONS.map((option) => (\n                <option key={option} value={option}>\n                  {option}\n                </option>\n              ))}\n            </select>\n          </label>\n          <label>\n            <span>Language</span>\n            <select value={state.locale} onChange={(event) => handleStateChange({ locale: event.target.value })}>\n              {LOCALE_OPTIONS.map((option) => (\n                <option key={option.value} value={option.value}>\n                  {option.label}\n                </option>\n              ))}\n            </select>\n          </label>\n          <label>\n            <span>Currency</span>\n            <select value={state.currency} onChange={(event) => handleStateChange({ currency: event.target.value })}>\n              {CURRENCY_OPTIONS.map((currency) => (\n                <option key={currency} value={currency}>\n                  {currency}\n                </option>\n              ))}\n            </select>\n          </label>\n        </div>\n\n        <label>\n          <span>Product ID</span>\n          <input\n            type=\"number\"\n            min={1}\n            value={state.productId}\n            onChange={(event) => handleStateChange({ productId: Number(event.target.value) })}\n            required\n          />\n        </label>\n\n        <section className=\"yw-groups\" aria-label=\"Guests\">\n          {state.groups.map((group, index) => (\n            <div key={index} className=\"yw-group\">\n              <header className=\"yw-summary\">Room {index + 1}</header>\n              <div className=\"yw-group-controls\">\n                <label>\n                  <span>Rooms</span>\n                  <input\n                    type=\"number\"\n                    min={1}\n                    value={group.rooms}\n                    onChange={(event) =>\n                      onGroupChange(index, { rooms: Math.max(1, Number(event.target.value) || 1) })\n                    }\n                    required\n                  />\n                </label>\n                <label>\n                  <span>Adults</span>\n                  <input\n                    type=\"number\"\n                    min={1}\n                    value={group.adults}\n                    onChange={(event) =>\n                      onGroupChange(index, { adults: Math.max(1, Number(event.target.value) || 1) })\n                    }\n                    required\n                  />\n                </label>\n                <label>\n                  <span>Children ages</span>\n                  <input\n                    type=\"text\"\n                    placeholder=\"e.g. 5.8\"\n                    value={group.childrenAges.join('.')}\n                    onChange={(event) => onChildrenChange(index, event.target.value)}\n                  />\n                </label>\n                <label>\n                  <span>Infants</span>\n                  <input\n                    type=\"number\"\n                    min={0}\n                    value={group.infants}\n                    onChange={(event) =>\n                      onGroupChange(index, { infants: Math.max(0, Number(event.target.value) || 0) })\n                    }\n                  />\n                </label>\n              </div>\n              {state.groups.length > 1 && (\n                <button\n                  type=\"button\"\n                  className=\"yw-secondary\"\n                  onClick={() => removeGroup(index)}\n                  aria-label={`Remove room ${index + 1}`}\n                >\n                  Remove room\n                </button>\n              )}\n            </div>\n          ))}\n          <button type=\"button\" className=\"yw-secondary\" onClick={addGroup}>\n            Add room\n          </button>\n          <p className=\"yw-summary\">\n            {groupsSummary.rooms} rooms · {groupsSummary.adults} adults · {groupsSummary.children} children ·{' '}\n            {groupsSummary.infants} infants\n          </p>\n        </section>\n\n        <label>\n          <span>\n            Redirect to booking engine\n            <input\n              type=\"checkbox\"\n              checked={state.redirect}\n              onChange={(event) => handleStateChange({ redirect: event.target.checked })}\n              style={{ marginLeft: '0.5rem' }}\n            />\n          </span>\n        </label>\n\n        {errorMessage && <p className=\"yw-error\">{errorMessage}</p>}\n\n        <div className=\"yw-actions\">\n          <button type=\"submit\" className=\"yw-primary\" disabled={state.isSearching}>\n            {state.isSearching ? 'Searching…' : 'Search'}\n          </button>\n          <small className=\"yw-summary\">{formatGroupsForm(state.groups)}</small>\n        </div>\n      </form>\n    </div>\n  );\n};\n\nBookingSearchWidget.displayName = 'BookingSearchWidget';\n"]}